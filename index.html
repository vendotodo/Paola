<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vendo Todo - Javi Belloni</title>
  <link rel="stylesheet" href="static/css/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="brand">
        <div class="logo">JB</div>
        <div>
          <div class="site-title">Vendo Todo.</div>
          <div style="color:var(--muted); font-size:13px">Si te interesa algo, me mandas mensaje</div>
				
        </div>
      </div>
    </div>
  </header>

  <main class="container" style="padding-top:18px">
    <!-- Nuevo bloque de filtros y ordenamiento -->
    <div class="controls">
      <input id="search" class="search" placeholder="Buscar..." style="flex:1" />
      <select id="sort" class="select">
        <option value="none">Ordenar</option>
        <option value="price_asc">Precio ↑</option>
        <option value="price_desc">Precio ↓</option>
        <option value="name_asc">Nombre A→Z</option>
      </select>
    </div>

    <div id="catalog" class="grid"></div>
  </main>
  
		  
						  
														  
										 
						 
							   
				  
															   
														   
				
	  
   
  
							   
												
								 
								   
  
														
							
  
						 
													
							 
								
								  
																					 

						
															  
						  
											
																			 
																		
																			  
														  
			   
														   
								 
	  
   
  
			   
		   
  
  <!-- Overlay de producto -->
  <div id="productOverlay" class="overlay">
    <div class="overlay-content">
      <span class="close-btn" onclick="closeOverlay()">&times;</span>
		
						 
							  
																			  
																 
																			 
			  
	
      <h2 id="overlayName"></h2>
      <p id="overlayDescription"></p>
								
      <p id="overlayPrice"></p>
			
    </div>
  </div>

  <a href="#" class="whatsapp-button" target="_blank">
    <i class="fab fa-whatsapp"></i>
		
  </a>

<script>
let overlayLoadToken = 0;
let currentSlide = 0;
let products = [];

function parseCSV(text){
  const [headerLine, ...lines] = text.trim().split("\n");
  const headers = headerLine.split(",");
  return lines.map(l => {
    const cols = l.split(",");
    let obj = {};
    headers.forEach((h,i) => obj[h.trim()] = cols[i]?.trim());
    obj.price = obj.price ? parseFloat(obj.price) : null;
    return obj;
  });
}

async function loadCatalog(){
  const res = await fetch("data/products.csv");
  const text = await res.text();
  products = parseCSV(text);
  renderCatalog(products);
}

function renderCatalog(list){
  const container = document.getElementById("catalog");
  container.innerHTML = "";
  list.forEach(p => {
    const displayPrice = p.price !== null ? `$${p.price.toFixed(2)}` : "Consultar";
    const card = document.createElement("article");
    card.className = "card";
    card.dataset.name = p.name;
    card.dataset.price = p.price;
    card.dataset.description = p.description;
    card.innerHTML = `
      <img src="static/images/${p.id}.jpeg" alt="${p.name}">
      <div class="meta">
        <div class="title">${p.name}</div>
        <div style="font-size:13px; color:var(--muted)">${p.category}</div>
        <div style="font-size:13px; color:#444">${p.description}</div>
        <div class="price">${displayPrice}</div>
      </div>`;
    card.addEventListener("click", () => openOverlay(p));
    container.appendChild(card);
  });
}

// Filtro por búsqueda
const searchInput = document.getElementById("search");
searchInput.addEventListener("input", () => {
  const term = searchInput.value.toLowerCase();
  const filtered = products.filter(p => p.name.toLowerCase().includes(term));
  renderCatalog(filtered);
});

// Ordenamiento
const sortSelect = document.getElementById("sort");
sortSelect.addEventListener("change", () => {
  let sorted = [...products];
  if(sortSelect.value === "price_asc") sorted.sort((a,b) => (a.price||0) - (b.price||0));
  if(sortSelect.value === "price_desc") sorted.sort((a,b) => (b.price||0) - (a.price||0));
  if(sortSelect.value === "name_asc") sorted.sort((a,b) => a.name.localeCompare(b.name));
  renderCatalog(sorted);
});
   

					  
									   
										   
																 
		 
													   
				   
																		  
			  
													
	   
				 
			
	 
   

						   
								 
																	  
		   
   

									 
											  
				  
											   
							   
	 

				   
																							   
																							   
 

async function openOverlay(product){
  const token = ++overlayLoadToken;
  document.getElementById('overlayName').textContent = product.name || '';
  document.getElementById('overlayDescription').textContent = product.description || '';
  document.getElementById('overlayPrice').textContent = (product.price && !isNaN(product.price)) ? `Precio: $${product.price}` : 'Consultar';
  
															   
						 
				  

																				  
  document.getElementById('productOverlay').style.display = 'flex';
												
}

function closeOverlay(){
  overlayLoadToken++;
  document.getElementById('productOverlay').style.display = 'none';
														   
}

							
																
										 
												
																   
											 
 

// Delegación para clic en tarjeta
// (manteniendo lógica original)
document.addEventListener('click', function(ev) {
  const card = ev.target.closest && ev.target.closest('.card');
  if (card && document.getElementById('catalog').contains(card)) {
    const imgEl = card.querySelector('img');
    const imageSrc = imgEl ? imgEl.getAttribute('src') : (card.dataset.image || '');
    const name = card.dataset.name || (card.querySelector('.title') && card.querySelector('.title').textContent.trim()) || '';
    const descNode = card.querySelector('.meta > div:nth-child(3)');
    const description = descNode ? descNode.textContent.trim() : (card.dataset.description || '');
																	
																					
    const price = card.dataset.price || (card.querySelector('.price') && card.querySelector('.price').textContent.replace('$','').trim()) || '';
    openOverlay({ image: imageSrc, name: name, description: description, price: price });
    return;
  }

																								
																							   
																			   
																				 
});

const phone = "5491165031891";
const message = "Hola, quiero más información.";
const link = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
document.querySelector(".whatsapp-button").setAttribute("href", link);

loadCatalog();
</script>

</body>
</html>
